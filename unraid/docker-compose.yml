# Unraid Docker Compose Stack
# All containers migrated from Unraid native Docker management
# Generated: 2026-01-10

services:
  # ============================================================================
  # MEDIA SERVERS
  # ============================================================================

  plex:
    image: plexinc/pms-docker:plexpass
    container_name: plex
    hostname: plex
    restart: unless-stopped
    network_mode: host

    environment:
      - TZ=${TZ}
      - PLEX_CLAIM=${PLEX_CLAIM}
      - ADVERTISE_IP=http://${UNRAID_IP}:32400/
      - ALLOWED_NETWORKS=${LOCAL_NETWORK}

    volumes:
      # Config
      - /mnt/user/appdata/plex:/config

      # Media
      - /mnt/user/media:/media

      # Transcoding (tmpfs for performance)
      - /dev/shm:/transcode

    devices:
      - /dev/dri:/dev/dri  # Intel QuickSync hardware transcoding

    security_opt:
      - no-new-privileges:true

    deploy:
      resources:
        limits:
          memory: 8G
        reservations:
          memory: 2G

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # DOWNLOAD MANAGEMENT
  # ============================================================================

  sabnzbd:
    image: lscr.io/linuxserver/sabnzbd:latest
    container_name: sabnzbd
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "8080:8080"
      - "9090:9090"

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK=022

    volumes:
      - /mnt/user/appdata/sabnzbd:/config
      - /mnt/cache/downloads:/downloads
      - /mnt/user/media:/media

    security_opt:
      - no-new-privileges:true

    user: "${PUID}:${PGID}"
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=512m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 512M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # MEDIA AUTOMATION (*ARR STACK)
  # ============================================================================

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "8989:8989"

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK=022

    volumes:
      - /mnt/disk1/appdata/sonarr:/config
      - /mnt/cache/downloads:/downloads
      - /mnt/user/media:/media

    security_opt:
      - no-new-privileges:true

    user: "${PUID}:${PGID}"
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 256M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "7878:7878"

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK=022

    volumes:
      - /mnt/disk1/appdata/radarr:/config
      - /mnt/user/downloads:/downloads
      - /mnt/user/media:/media

    security_opt:
      - no-new-privileges:true

    user: "${PUID}:${PGID}"
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 256M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "6767:6767"

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}

    volumes:
      - /mnt/disk1/appdata/bazarr:/config
      - /mnt/user/media/Movies:/movies
      - /mnt/user/media/TV:/tv

    security_opt:
      - no-new-privileges:true

    user: "${PUID}:${PGID}"
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # MEDIA REQUESTS & DISCOVERY
  # ============================================================================

  overseerr:
    image: lscr.io/linuxserver/overseerr:latest
    container_name: overseerr
    restart: unless-stopped

    networks:
      - proxy

    ports:
      - "5055:5055"

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK=022

    volumes:
      - /mnt/disk1/appdata/overseerr:/config

    security_opt:
      - no-new-privileges:true

    user: "${PUID}:${PGID}"
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  requestrr:
    image: thomst08/requestrr:latest
    container_name: requestrr
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "4545:4545"

    environment:
      - TZ=${TZ}

    extra_hosts:
      - "host.docker.internal:host-gateway"

    security_opt:
      - no-new-privileges:true

    user: "65534:65534"  # nobody:nogroup
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=128m

    pids_limit: 128

    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 64M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # MEDIA INDEXING & SEARCH
  # ============================================================================

  nzbhydra2:
    image: lscr.io/linuxserver/nzbhydra2:latest
    container_name: nzbhydra2
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "5076:5076"

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - SHARED_NETWORK=${SHARED_NETWORK}

    volumes:
      - /mnt/disk1/appdata/nzbhydra2:/config
      - /mnt/user/downloads:/data

    security_opt:
      - no-new-privileges:true

    user: "${PUID}:${PGID}"
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=512m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # MEDIA STATISTICS & MONITORING
  # ============================================================================

  tautulli:
    image: lscr.io/linuxserver/tautulli:latest
    container_name: tautulli
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "8181:8181"

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK=022

    volumes:
      - /mnt/disk1/appdata/tautulli:/config

    security_opt:
      - no-new-privileges:true

    user: "${PUID}:${PGID}"
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # MEDIA MANAGEMENT & AUTOMATION
  # ============================================================================

  kometa:
    image: kometateam/kometa:latest
    container_name: kometa
    restart: unless-stopped
    network_mode: bridge

    environment:
      - KOMETA_CONFIG=${KOMETA_CONFIG}
      - KOMETA_TIME=${KOMETA_TIME}
      - KOMETA_RUN=${KOMETA_RUN}
      - KOMETA_TEST=${KOMETA_TEST}
      - KOMETA_NO_MISSING=${KOMETA_NO_MISSING}

    volumes:
      - /mnt/disk1/kometa:/config

    security_opt:
      - no-new-privileges:true

    user: "65534:65534"  # nobody:nogroup
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 256M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  ersatztv:
    image: jasongdove/ersatztv:latest
    container_name: ersatztv
    restart: unless-stopped
    network_mode: host

    environment:
      - TZ=${TZ}

    extra_hosts:
      - "host.docker.internal:host-gateway"

    volumes:
      - /mnt/disk1/appdata/ersatztv:/root/.local/share/ersatztv

    devices:
      - /dev/dri:/dev/dri  # Hardware transcoding

    security_opt:
      - no-new-privileges:true

    tty: false
    stdin_open: false

    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 512M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  huntarr:
    image: hotdari/huntarr:latest
    container_name: huntarr
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "5702:5702"

    security_opt:
      - no-new-privileges:true

    user: "65534:65534"  # nobody:nogroup
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=128m

    pids_limit: 128

    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 64M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # REVERSE PROXY & NETWORKING
  # ============================================================================

  nginxproxymanager:
    image: jc21/nginx-proxy-manager:latest
    container_name: nginxproxymanager
    restart: unless-stopped

    networks:
      - proxy

    ports:
      - "81:81"    # Admin UI
      - "80:80"    # HTTP
      - "443:443"  # HTTPS

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - DISABLE_IPV6=true

    volumes:
      - /mnt/disk1/nginxproxymanager/config:/config
      - /mnt/disk1/nginxproxymanager/letsencrypt:/etc/letsencrypt
      - /mnt/disk1/nginxproxymanager/data:/data

    security_opt:
      - no-new-privileges:true

    cap_drop:
      - ALL

    cap_add:
      - NET_BIND_SERVICE  # Bind to ports 80/443
      - CHOWN
      - DAC_OVERRIDE
      - SETGID
      - SETUID

    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # BACKUP & SYNC
  # ============================================================================

  icloudpd:
    image: boredazfcuk/icloudpd:latest
    container_name: icloudpd
    restart: unless-stopped
    network_mode: bridge

    environment:
      - apple_id=${ICLOUD_APPLE_ID}
      - synchronisation_interval=${ICLOUD_SYNC_INTERVAL:-86400}
      - TZ=${TZ}

    volumes:
      - /mnt/disk1/appdata/icloudpd:/config
      - /mnt/user/media/iCloudPhotos:/home/user/iCloud

    security_opt:
      - no-new-privileges:true

    user: "${PUID}:${PGID}"
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=512m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # MONITORING & SYSTEM TOOLS
  # ============================================================================

  scrutiny:
    image: ghcr.io/analogj/scrutiny:master-omnibus
    container_name: scrutiny
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "8383:8080"  # Web UI

    cap_add:
      - SYS_RAWIO  # Required for S.M.A.R.T. monitoring
      - SYS_ADMIN  # Required for disk access

    volumes:
      - /run/udev:/run/udev:ro
      - /dev/disk:/dev/disk:ro
      - /opt/scrutiny/config:/opt/scrutiny/config
      - /opt/scrutiny/influxdb:/opt/scrutiny/influxdb

    devices:
      - /dev/sda
      - /dev/sdb
      - /dev/sdc
      - /dev/sdd
      - /dev/sde
      - /dev/sdf
      - /dev/nvme0n1

    security_opt:
      - no-new-privileges:true

    privileged: true  # Required for disk access

    tty: false
    stdin_open: false

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  glances:
    image: nicolargo/glances:latest
    container_name: glances
    restart: unless-stopped
    network_mode: host

    environment:
      - GLANCES_OPT=-w

    volumes:
      - /mnt:/mnt
      - /var/run/docker.sock:/var/run/docker.sock:ro

    pid: host

    extra_hosts:
      - "host:host-gateway"

    security_opt:
      - no-new-privileges:true

    tty: false
    stdin_open: false

    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 64M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  dozzle:
    image: amir20/dozzle:latest
    container_name: dozzle
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "8084:8080"

    environment:
      - DOZZLE_BASE=/
      - DOZZLE_LEVEL=info
      - DOZZLE_TAILSIZE=500
      - DOZZLE_USERNAME=${DOZZLE_USERNAME}
      - DOZZLE_PASSWORD=${DOZZLE_PASSWORD}
      - DOZZLE_KEY=${DOZZLE_KEY}
      - DOZZLE_NO_ANALYTICS=true

    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro

    security_opt:
      - no-new-privileges:true

    user: "65534:65534"  # nobody:nogroup
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=128m

    pids_limit: 128

    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 64M

    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "1"

  speedtracker:
    image: lscr.io/linuxserver/speedtest-tracker:latest
    container_name: speedtracker
    restart: unless-stopped
    network_mode: bridge

    ports:
      - "8765:80"

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - APP_KEY=${SPEEDTEST_APP_KEY}
      - DB_CONNECTION=${SPEEDTEST_DB_CONNECTION}
      - SPEEDTEST_SCHEDULE=${SPEEDTEST_SCHEDULE}
      - SPEEDTEST_SERVERS=${SPEEDTEST_SERVERS}
      - PRUNE_RESULTS_OLDER_THAN=${SPEEDTEST_PRUNE_RESULTS_OLDER_THAN}
      - DISPLAY_TIMEZONE=${TZ}

    volumes:
      - /mnt/disk1/speedtracker/config:/config
      - /mnt/disk1/speedtracker/web:/etc/ssl/web

    security_opt:
      - no-new-privileges:true

    user: "${PUID}:${PGID}"
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # CHECKMATE STACK (Backend + Database)
  # ============================================================================

  checkmate:
    image: ghcr.io/binarynate-llc/checkmate-backend-main-multiplatform:latest
    container_name: checkmate
    restart: unless-stopped

    networks:
      - checkmate

    ports:
      - "52343:52343"

    environment:
      - CLIENT_HOST=${CHECKMATE_CLIENT_HOST}
      - UPTIME_APP_API_BASE_URL=${CHECKMATE_UPTIME_APP_API_BASE_URL}
      - UPTIME_APP_CLIENT_HOST=${CHECKMATE_UPTIME_APP_CLIENT_HOST}
      - DB_CONNECTION_STRING=${CHECKMATE_DB_CONNECTION_STRING}
      - JWT_SECRET=${CHECKMATE_JWT_SECRET}
      - TOKEN_TTL=${CHECKMATE_TOKEN_TTL}
      - ORIGIN=${CHECKMATE_ORIGIN}
      - REDIS_URL=${CHECKMATE_REDIS_URL}

    depends_on:
      - mongodb_checkmate
      - redis_checkmate

    security_opt:
      - no-new-privileges:true

    user: "65534:65534"  # nobody:nogroup
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 256

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  mongodb_checkmate:
    image: mongo:latest
    container_name: mongodb_checkmate
    restart: unless-stopped

    networks:
      - checkmate

    ports:
      - "27017:27017"

    volumes:
      - /mnt/disk1/mongodb/data:/data/db

    security_opt:
      - no-new-privileges:true

    user: "999:999"  # mongodb user
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m

    pids_limit: 512

    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 256M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  redis_checkmate:
    image: redis:latest
    container_name: redis_checkmate
    restart: unless-stopped

    networks:
      - checkmate

    ports:
      - "6379:6379"

    security_opt:
      - no-new-privileges:true

    user: "999:1000"  # redis user (verified redis:alpine pattern)
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=128m

    pids_limit: 128

    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 64M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ============================================================================
  # BESZEL MONITORING AGENT
  # ============================================================================

  beszel-agent:
    image: henrygd/beszel-agent:latest
    container_name: beszel-agent-unraid
    hostname: unraid
    restart: unless-stopped
    network_mode: host

    environment:
      PORT: 45876
      KEY: "${BESZEL_AGENT_KEY}"

    volumes:
      - ./beszel_agent_data:/var/lib/beszel-agent
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /:/host:ro

    security_opt:
      - no-new-privileges:true

    cap_drop:
      - ALL

    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE
      - SYS_PTRACE
      - NET_ADMIN

    user: "0:0"  # Root required for system monitoring
    tty: false
    stdin_open: false

    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=128m

    pids_limit: 128

    deploy:
      resources:
        limits:
          memory: 128M
        reservations:
          memory: 64M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# ============================================================================
# NETWORKS
# ============================================================================

networks:
  # Reverse proxy network
  proxy:
    name: proxy
    driver: bridge

  # Checkmate internal network
  checkmate:
    name: checkmate
    driver: bridge
    internal: true  # No external access

services:
  traefik:
    image: traefik:latest
    container_name: traefik
    restart: unless-stopped
    # user: "1000:1000" #commented out for now
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
      - CHOWN
      - SETGID
      - SETUID
    networks:
      - proxy
    ports:
      - 80:80
      - 443:443
    env_file:
      - .env
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /home/ubuntu/docker-data/traefik/data/traefik.yml:/traefik.yml:ro
      - /home/ubuntu/docker-data/traefik/data/acme.json:/acme.json
      - /home/ubuntu/docker-data/traefik/data/acme.json:/acme-cloudflare.json
      - /home/ubuntu/docker-data/traefik/data/configurations:/configurations
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      # Route for duckdns domain
      - "traefik.http.routers.traefik-secure.entrypoints=websecure"
      - "traefik.http.routers.traefik-secure.rule=Host(`traefik.${DUCKDNS_DOMAIN}`)"
      - "traefik.http.routers.traefik-secure.tls.certresolver=duckdns"
      - "traefik.http.routers.traefik-secure.service=api@internal"
      - "traefik.http.routers.traefik-secure.middlewares=user-auth@file"
      # Route for search domain
      - "traefik.http.routers.traefik-searchdomain.entrypoints=websecure"
      - "traefik.http.routers.traefik-searchdomain.rule=Host(`traefik.${SEARCH_DOMAIN}`)"
      - "traefik.http.routers.traefik-searchdomain.tls.certresolver=cloudflare"
      - "traefik.http.routers.traefik-searchdomain.service=api@internal"
      - "traefik.http.routers.traefik-searchdomain.middlewares=user-auth@file"
    # healthcheck:
    #   test: ["CMD", "traefik", "healthcheck", "--ping"]
    #   interval: 10s
    #   timeout: 5s
    #   retries: 3
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "1"

####################################################################################################

  # portainer:
  #   image: portainer/portainer-ce:latest
  #   container_name: portainer
  #   restart: unless-stopped
  #   security_opt:
  #     - no-new-privileges:true
  #   cap_drop:
  #     - ALL
  #   cap_add:
  #     - CHOWN
  #     - SETGID
  #     - SETUID
  #     - DAC_OVERRIDE
  #   networks:
  #     - proxy
  #   volumes:
  #     - /etc/localtime:/etc/localtime:ro
  #     - /var/run/docker.sock:/var/run/docker.sock:ro
  #     - /home/ubuntu/docker-data/portainer:/data
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.docker.network=proxy"
  #     # Route for duckdns domain
  #     - "traefik.http.routers.portainer-secure.entrypoints=websecure"
  #     - "traefik.http.routers.portainer-secure.rule=Host(`portainer.${DUCKDNS_DOMAIN}`)"
  #     - "traefik.http.routers.portainer-secure.tls.certresolver=duckdns"
  #     - "traefik.http.routers.portainer-secure.service=portainer-service"
  #     # Route for search domain
  #     - "traefik.http.routers.portainer-searchdomain.entrypoints=websecure"
  #     - "traefik.http.routers.portainer-searchdomain.rule=Host(`portainer.${SEARCH_DOMAIN}`)"
  #     - "traefik.http.routers.portainer-searchdomain.tls.certresolver=cloudflare"
  #     - "traefik.http.routers.portainer-searchdomain.service=portainer-service"
  #     # Service definition
  #     - "traefik.http.services.portainer-service.loadbalancer.server.port=9000"
  #   deploy:
  #     resources:
  #       limits:
  #         memory: 256M
  #       reservations:
  #         memory: 128M
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "1m"
  #       max-file: "1"

####################################################################################################

  # headscale:
  #   image: headscale/headscale:latest
  #   container_name: headscale
  #   restart: unless-stopped
  #   security_opt:
  #     - no-new-privileges:true
  #   cap_drop:
  #     - ALL
  #   cap_add:
  #     - CHOWN
  #     - SETGID
  #     - SETUID
  #     - NET_ADMIN
  #     - NET_RAW
  #     - DAC_OVERRIDE  # allows file access overrides
  #     - FOWNER        # allows changing file ownership
  #   networks:
  #     - proxy
  #   volumes:
  #     - /etc/localtime:/etc/localtime:ro
  #     - /var/run/docker.sock:/var/run/docker.sock:ro
  #     - /home/ubuntu/docker-data/headscale/config:/etc/headscale
  #     - /home/ubuntu/docker-data/headscale/data:/var/lib/headscale
  #   command: headscale serve
  #   labels:
      # - "traefik.enable=true"
      # - "traefik.docker.network=proxy"
      # # Route for duckdns domain (uses duckdns cert)
      # - "traefik.http.routers.headscale-secure.entrypoints=websecure"
      # - "traefik.http.routers.headscale-secure.rule=Host(`headscale.${DUCKDNS_DOMAIN}`)"
      # - "traefik.http.routers.headscale-testdomain.tls.certresolver=duckdns"
      # - "traefik.http.routers.headscale-secure.service=headscale-service"
      # # Route for test.com domain (uses cloudflare cert)
      # - "traefik.http.routers.headscale-testdomain.entrypoints=websecure"
      # - "traefik.http.routers.headscale-testdomain.rule=Host(`headscale.${SEARCH_DOMAIN}`)"
      # - "traefik.http.routers.headscale-testdomain.tls.certresolver=cloudflare"
      # - "traefik.http.routers.headscale-testdomain.service=headscale-service"
      # # Service definition
      # - "traefik.http.services.headscale-service.loadbalancer.server.port=8080"
  #   deploy:
  #     resources:
  #       limits:
  #         memory: 256M
  #       reservations:
  #         memory: 128M
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "1m"
  #       max-file: "1"
####################################################################################################

  # healthchecks:
  #   image: linuxserver/healthchecks:latest
  #   container_name: healthchecks
  #   restart: unless-stopped
  #   security_opt:
  #     - no-new-privileges:true
  #   cap_drop:
  #     - ALL
  #   cap_add:
  #     - CHOWN
  #     - SETGID
  #     - SETUID
  #     - DAC_OVERRIDE
  #   networks:
  #     - proxy
  #   volumes:
  #     - /etc/localtime:/etc/localtime:ro
  #     - /var/run/docker.sock:/var/run/docker.sock:ro
  #     - /home/ubuntu/docker-data/healthchecks:/config
  #   env_file:
  #     - .env
  #   labels:
      # - "traefik.enable=true"
      # - "traefik.docker.network=proxy"
      # # Route for duckdns domain (uses duckdns cert)
      # - "traefik.http.routers.healthchecks-secure.entrypoints=websecure"
      # - "traefik.http.routers.healthchecks-secure.rule=Host(`healthchecks.${DUCKDNS_DOMAIN}`)"
      # - "traefik.http.routers.healthchecks-testdomain.tls.certresolver=duckdns"
      # - "traefik.http.routers.healthchecks-secure.service=healthchecks-service"
      # # Route for test.com domain (uses cloudflare cert)
      # - "traefik.http.routers.healthchecks-testdomain.entrypoints=websecure"
      # - "traefik.http.routers.healthchecks-testdomain.rule=Host(`healthchecks.${SEARCH_DOMAIN}`)"
      # - "traefik.http.routers.healthchecks-testdomain.tls.certresolver=cloudflare"
      # - "traefik.http.routers.healthchecks-testdomain.service=healthchecks-service"
      # # Service definition
      # - "traefik.http.services.healthchecks-service.loadbalancer.server.port=8080"
  #   deploy:
  #     resources:
  #       limits:
  #         memory: 512M
  #       reservations:
  #         memory: 256M
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "1m"
  #       max-file: "1"
####################################################################################################

  # gitea:
  #   image: gitea/gitea:latest
  #   container_name: gitea
  #   depends_on:
  #     - traefik
  #     - gitea-cache
  #   restart: unless-stopped
  #   security_opt:
  #     - no-new-privileges:true
  #   cap_drop:
  #     - ALL
  #   cap_add:
  #     - CHOWN
  #     - SETGID
  #     - SETUID
  #     - DAC_OVERRIDE
  #   environment:
  #     - APP_NAME="Gitea"
  #     - USER_UID=1000
  #     - USER_GID=1000
  #     - USER=git
  #     - RUN_MODE=prod
  #     - DOMAIN=gitea.${SEARCH_DOMAIN}
  #     - SSH_DOMAIN=gitea.${SEARCH_DOMAIN}
  #     - HTTP_PORT=3000
  #     - ROOT_URL=https://gitea.${SEARCH_DOMAIN}
  #     - SSH_PORT=222
  #     - SSH_LISTEN_PORT=22
  #     - DB_TYPE=sqlite3
  #     - GITEA__cache__ENABLED=true
  #     - GITEA__cache__ADAPTER=redis
  #     - GITEA__cache__HOST=redis://gitea-cache:6379/0?pool_size=100&idle_timeout=180s
  #     - GITEA__cache__ITEM_TTL=24h
  #   networks:
  #     - proxy
  #   volumes:
  #     - /home/ubuntu/docker-data/gitea:/data
  #     - /etc/timezone:/etc/timezone:ro
  #     - /etc/localtime:/etc/localtime:ro
  #   ports:
  #     - "222:22"
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.docker.network=proxy"
  #     # Route for duckdns domain
  #     # - "traefik.http.routers.gitea-secure.entrypoints=websecure"
  #     # - "traefik.http.routers.gitea-secure.rule=Host(`gitea.${DUCKDNS_DOMAIN}`)"
  #     # - "traefik.http.routers.gitea-secure.tls.certresolver=duckdns"
  #     # - "traefik.http.routers.gitea-secure.service=gitea-service"
  #     # Route for search domain
  #     - "traefik.http.routers.gitea-searchdomain.entrypoints=websecure"
  #     - "traefik.http.routers.gitea-searchdomain.rule=Host(`gitea.${SEARCH_DOMAIN}`)"
  #     - "traefik.http.routers.gitea-searchdomain.tls.certresolver=cloudflare"
  #     - "traefik.http.routers.gitea-searchdomain.service=gitea-service"
  #     # Service definition
  #     - "traefik.http.services.gitea-service.loadbalancer.server.port=3000"
  #   # healthcheck:
  #   #   test: ["CMD", "curl", "-f", "http://localhost:3000/"]
  #   #   interval: 30s
  #   #   timeout: 5s
  #   #   retries: 3
  #   #   start_period: 10s
  #   deploy:
  #     resources:
  #       limits:
  #         memory: 512M
  #       reservations:
  #         memory: 128M
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "1m"
  #       max-file: "1"

  # gitea-cache:
  #   container_name: gitea-cache
  #   image: docker.io/valkey/valkey:8-alpine
  #   restart: unless-stopped
  #   security_opt:
  #     - no-new-privileges:true
  #   cap_drop:
  #     - ALL
  #   cap_add:
  #     - SETGID
  #     - SETUID
  #     - DAC_OVERRIDE
  #   networks:
  #     - proxy
  #   # healthcheck:
  #   #   test: ["CMD", "valkey-cli", "ping"]
  #   #   interval: 15s
  #   #   timeout: 3s
  #   #   retries: 30
  #   deploy:
  #     resources:
  #       limits:
  #         memory: 128M
  #       reservations:
  #         memory: 64M
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "1m"
  #       max-file: "1"

  forgejo:
    image: codeberg.org/forgejo/forgejo:9
    container_name: forgejo
    depends_on:
      - traefik
      - forgejo-cache
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE
    environment:
      - APP_NAME="Forgejo"
      - USER_UID=1000
      - USER_GID=1000
      - USER=git
      - RUN_MODE=prod
      - DOMAIN=git.${SEARCH_DOMAIN}
      - SSH_DOMAIN=git.${SEARCH_DOMAIN}
      - HTTP_PORT=3000
      - ROOT_URL=https://git.${SEARCH_DOMAIN}
      - SSH_PORT=222
      - SSH_LISTEN_PORT=22
      - DB_TYPE=sqlite3
      - FORGEJO__cache__ENABLED=true
      - FORGEJO__cache__ADAPTER=redis
      - FORGEJO__cache__HOST=redis://forgejo-cache:6379/0?pool_size=100&idle_timeout=180s
      - FORGEJO__cache__ITEM_TTL=24h
    networks:
      - proxy
    volumes:
      - /home/ubuntu/docker-data/forgejo:/data
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "222:22"
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      # Route for duckdns domain
      # - "traefik.http.routers.forgejo-secure.entrypoints=websecure"
      # - "traefik.http.routers.forgejo-secure.rule=Host(`git.${DUCKDNS_DOMAIN}`)"
      # - "traefik.http.routers.forgejo-secure.tls.certresolver=duckdns"
      # - "traefik.http.routers.forgejo-secure.service=forgejo-service"
      # Route for search domain
      - "traefik.http.routers.forgejo-searchdomain.entrypoints=websecure"
      - "traefik.http.routers.forgejo-searchdomain.rule=Host(`git.${SEARCH_DOMAIN}`)"
      - "traefik.http.routers.forgejo-searchdomain.tls.certresolver=cloudflare"
      - "traefik.http.routers.forgejo-searchdomain.service=forgejo-service"
      # Service definition
      - "traefik.http.services.forgejo-service.loadbalancer.server.port=3000"
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:3000/"]
    #   interval: 30s
    #   timeout: 5s
    #   retries: 3
    #   start_period: 10s
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "1"

  forgejo-cache:
    container_name: forgejo-cache
    image: docker.io/valkey/valkey:8-alpine
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - SETGID
      - SETUID
      - DAC_OVERRIDE
    networks:
      - proxy
    # healthcheck:
    #   test: ["CMD", "valkey-cli", "ping"]
    #   interval: 15s
    #   timeout: 3s
    #   retries: 30
    deploy:
      resources:
        limits:
          memory: 128M
        reservations:
          memory: 64M
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "1"

##################################################

  # gitea-mirror:
  #   image: ghcr.io/raylabshq/gitea-mirror:latest
  #   container_name: gitea-mirror
  #   depends_on:
  #     - gitea
  #   restart: unless-stopped
  #   security_opt:
  #     - no-new-privileges:true
  #   cap_drop:
  #     - ALL
  #   cap_add:
  #     - CHOWN
  #     - SETGID
  #     - SETUID
  #     - DAC_OVERRIDE
  #   networks:
  #     - proxy
  #   volumes:
  #     - /home/ubuntu/docker-data/gitea-mirror:/app/data
  #     - /etc/localtime:/etc/localtime:ro
  #   environment:
  #     # Basic settings
  #     - PORT=4321
  #     - PUID=1000
  #     - PGID=1000
      
  #     # GitHub configuration
  #     - GITHUB_TOKEN=${GITHUB_TOKEN}
  #     - GITHUB_USERNAME=${GITHUB_USERNAME}
      
  #     # Gitea configuration (using internal Docker network)
  #     - GITEA_URL=http://gitea:3000
  #     - GITEA_TOKEN=${GITEA_TOKEN}
      
  #     # Auto-sync configuration
  #     - SCHEDULE_ENABLED=true
  #     - SCHEDULE_INTERVAL=3600  # Check every hour (in seconds)
  #     - GITEA_MIRROR_INTERVAL=8h  # Sync each repo every 8 hours
      
  #     # Auto-import settings
  #     - AUTO_IMPORT_REPOS=true
      
  #     # Cleanup configuration (IMPORTANT - use archive for safety!)
  #     - CLEANUP_DELETE_IF_NOT_IN_GITHUB=true
  #     - CLEANUP_ORPHANED_REPO_ACTION=archive
  #     - CLEANUP_DRY_RUN=false
      
    # labels:
    #   - "traefik.enable=true"
    #   - "traefik.docker.network=proxy"
    #   # Route for duckdns domain
    #   - "traefik.http.routers.gitea-mirror-secure.entrypoints=websecure"
    #   - "traefik.http.routers.gitea-mirror-secure.rule=Host(`gitea-mirror.${DUCKDNS_DOMAIN}`)"
    #   - "traefik.http.routers.gitea-mirror-secure.tls.certresolver=duckdns"
    #   - "traefik.http.routers.gitea-mirror-secure.service=gitea-mirror-service"
    #   # Route for search domain
    #   - "traefik.http.routers.gitea-mirror-searchdomain.entrypoints=websecure"
    #   - "traefik.http.routers.gitea-mirror-searchdomain.rule=Host(`gitea-mirror.${SEARCH_DOMAIN}`)"
    #   - "traefik.http.routers.gitea-mirror-searchdomain.tls.certresolver=cloudflare"
    #   - "traefik.http.routers.gitea-mirror-searchdomain.service=gitea-mirror-service"
    #   # Service definition
    #   - "traefik.http.services.gitea-mirror-service.loadbalancer.server.port=4321"
  #   deploy:
  #     resources:
  #       limits:
  #         memory: 512M
  #       reservations:
  #         memory: 128M
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "1m"
  #       max-file: "1"

####################################################################################################

  uptime-kuma:
    image: louislam/uptime-kuma:latest
    container_name: uptime-kuma
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /home/ubuntu/docker-data/uptime-kuma:/app/data
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      # Route for duckdns domain
      # - "traefik.http.routers.uptime-kuma-secure.entrypoints=websecure"
      # - "traefik.http.routers.uptime-kuma-secure.rule=Host(`uptime.${DUCKDNS_DOMAIN}`)"
      # - "traefik.http.routers.uptime-kuma-secure.tls.certresolver=duckdns"
      # - "traefik.http.routers.uptime-kuma-secure.service=uptime-kuma-service"
      # Route for search domain
      - "traefik.http.routers.uptime-kuma-searchdomain.entrypoints=websecure"
      - "traefik.http.routers.uptime-kuma-searchdomain.rule=Host(`uptime.${SEARCH_DOMAIN}`)"
      - "traefik.http.routers.uptime-kuma-searchdomain.tls.certresolver=cloudflare"
      - "traefik.http.routers.uptime-kuma-searchdomain.service=uptime-kuma-service"
      # Service definition
      - "traefik.http.services.uptime-kuma-service.loadbalancer.server.port=3001"
    # healthcheck:
    #   test: ["CMD-SHELL", "curl -fs http://localhost:3001 || exit 1"]
    #   interval: 30s
    #   timeout: 5s
    #   retries: 3
    #   start_period: 20s
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "1"

####################################################################################################

  searxng:
    container_name: searxng
    image: docker.io/searxng/searxng:latest
    depends_on:
      - traefik
      - searxng-redis
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE
    networks:
      - proxy
    volumes:
      - /home/ubuntu/docker-data/searxng:/etc/searxng:rw
    environment:
      - SEARXNG_BASE_URL=https://search.${SEARCH_DOMAIN}/
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      # Route for duckdns domain (uses duckdns cert)
      # - "traefik.http.routers.searxng-secure.entrypoints=websecure"
      # - "traefik.http.routers.searxng-secure.rule=Host(`search.${DUCKDNS_DOMAIN}`)"
      # - "traefik.http.routers.searxng-testdomain.tls.certresolver=duckdns"
      # - "traefik.http.routers.searxng-secure.service=searxng-service"
      # Route for test.com domain (uses cloudflare cert)
      - "traefik.http.routers.searxng-searchdomain.entrypoints=websecure"
      - "traefik.http.routers.searxng-searchdomain.rule=Host(`search.${SEARCH_DOMAIN}`)"
      - "traefik.http.routers.searxng-searchdomain.tls.certresolver=cloudflare"
      - "traefik.http.routers.searxng-searchdomain.service=searxng-service"
      # Service definition
      - "traefik.http.services.searxng-service.loadbalancer.server.port=8080"
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "1"

  searxng-redis:
    container_name: searxng-redis
    image: docker.io/valkey/valkey:8-alpine
    command: valkey-server --save 30 1 --loglevel warning
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - SETGID
      - SETUID
      - DAC_OVERRIDE
    networks:
      - proxy
    volumes:
      - searxng-valkey-data:/data
    healthcheck:
      test: ["CMD", "valkey-cli", "ping"]
      interval: 15s
      timeout: 3s
      retries: 30
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "1"

####################################################################################################

  capture:
    image: ghcr.io/bluewave-labs/capture:latest
    container_name: capture
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE
    networks:
      - proxy
    ports:
      - "59232:59232"
    environment:
      - API_SECRET=${CAPTURE_API_SECRET} # set in the .env file
      - GIN_MODE=release
    volumes:
      - /etc/os-release:/etc/os-release:ro
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      # Route for search domain
      - "traefik.http.routers.capture-searchdomain.entrypoints=websecure"
      - "traefik.http.routers.capture-searchdomain.rule=Host(`capture.${SEARCH_DOMAIN}`)"
      - "traefik.http.routers.capture-searchdomain.tls.certresolver=cloudflare"
      - "traefik.http.routers.capture-searchdomain.service=capture-service"
      # Service definition
      - "traefik.http.services.capture-service.loadbalancer.server.port=59232"
    deploy:
      resources:
        limits:
          memory: 128M
        reservations:
          memory: 64M
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "1"

####################################################################################################

  bentopdf:
    image: bentopdf/bentopdf-simple:latest
    container_name: bentopdf
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
    networks:
      - proxy
    ports:
      - '3000:8080'
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=America/Chicago
    volumes:
      - /etc/os-release:/etc/os-release:ro
      - /etc/localtime:/etc/localtime:ro
      - /dev/shm:/dev/shm
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      # Route for search domain
      - "traefik.http.routers.bentopdf-homedomain.entrypoints=websecure"
      - "traefik.http.routers.bentopdf-homedomain.rule=Host(`pdf.${SEARCH_DOMAIN}`)"
      - "traefik.http.routers.bentopdf-homedomain.tls.certresolver=cloudflare"
      - "traefik.http.routers.bentopdf-homedomain.service=bentopdf-service"
      # Service definition
      - "traefik.http.services.bentopdf-service.loadbalancer.server.port=8080"
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "2"

####################################################################################################        

networks:
  proxy:
    external: true

volumes:
  searxng-valkey-data: